<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Vitalii Strashnov - iOS 5 Portfolio</title>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html {
            margin: 0; padding: 0; height: 100%; width: 100%; overflow: hidden;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            background-color: #2b2b2b;
            user-select: none;
        }

        #ios-container {
            width: 100%; height: 100%;
            background-image: url('wallpaper/ios5.png');
            background-size: cover;
            background-position: center;
            position: relative;
            display: flex; flex-direction: column;
            overflow: hidden;
        }

        #status-bar {
            height: 20px; background: rgba(0,0,0,0.8); color: #fff;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 5px; font-size: 12px; font-weight: bold; z-index: 1000;
            box-shadow: 0 1px 0 rgba(255,255,255,0.1);
        }

        #home-screen {
            flex-grow: 1; padding: 20px 15px;
            display: grid; grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(4, auto);
            gap: 15px 10px; align-content: start;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s;
            transform-origin: center;
        }

        .app-icon-wrapper {
            display: flex; flex-direction: column; align-items: center; gap: 5px;
            cursor: pointer;
        }
        .app-icon {
            width: 60px; height: 60px; border-radius: 12px;
            position: relative; overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
            
            background-color: #000; /* Fallback color */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            
            transition: transform 0.1s;
        }
        .app-icon:active { transform: scale(0.9); filter: brightness(0.8); }
        
        .app-icon::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 50%;
            background: linear-gradient(to bottom, rgba(255,255,255,0.6) 0%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0) 100%);
            border-radius: 12px 12px 0 0; pointer-events: none;
        }

        .app-name { color: #fff; font-size: 11px; text-shadow: 0 1px 2px rgba(0,0,0,0.8); font-weight: 500; text-align: center; }

        .icon-notes { 
            background-image: url('icons/com.apple.mobilenotes-large.png');
        }
        
        .icon-photos { 
            background-image: url('icons/com.apple.mobileslideshow-large.png');
        }

        .icon-phone {
            background-image: url('icons/com.apple.mobilephone-large.png');
        }

        .icon-mail {
            background-image: url('icons/com.apple.mobilemail-large.png');
        }

        .icon-safari {
            background-image: url('icons/com.apple.mobilesafari-large.png');
        }

        .icon-music {
            background-image: url('icons/com.apple.Music-large.png');
        }
        
        .icon-terminal { background: #222; border: 1px solid #000; display: flex; justify-content: center; align-items: center; font-family: monospace; color: #0f0; font-size: 30px; font-weight: bold; }
        .icon-game { background: #333; border: 1px solid #000; display:flex; justify-content:center; align-items:center; font-size: 30px; }
        .icon-linkedin { background: #0077b5; display: flex; align-items: center; justify-content: center; color: white; font-size: 32px; font-weight: bold; }


        #dock-shelf {
            height: 90px; margin-bottom: 0px;
            background: rgba(255, 255, 255, 0.2);
            border-top: 1px solid rgba(255,255,255,0.3);
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.2), 0 -2px 10px rgba(0,0,0,0.3);
            display: flex; justify-content: space-around; align-items: center; padding: 0 15px;
            backdrop-filter: blur(10px);
            transform: perspective(800px) rotateX(25deg);
            transform-origin: bottom center;
            z-index: 10;
        }
        .dock-wrapper { position: absolute; bottom: 65px; width: 100%; display: flex; justify-content: space-around; padding: 0 10px; z-index: 20; transition: transform 0.4s, opacity 0.3s; }

        #home-btn-area {
            height: 60px; background: #111;
            display: flex; justify-content: center; align-items: center;
            z-index: 2000;
        }
        #home-btn {
            width: 45px; height: 45px; border-radius: 50%;
            border: 2px solid #444;
            background: radial-gradient(circle at center, #222 0%, #000 100%);
            display: flex; justify-content: center; align-items: center;
            cursor: pointer;
        }
        #home-btn .square {
            width: 14px; height: 14px; border: 2px solid #666; border-radius: 3px;
        }
        #home-btn:active { background: #111; }

        .app-screen {
            position: absolute; top: 20px; left: 0; width: 100%; height: calc(100% - 80px);
            background: #fff; z-index: 100;
            transform: scale(0); opacity: 0;
            transition: transform 0.3s ease-in-out, opacity 0.2s;
            pointer-events: none; display: flex; flex-direction: column;
            overflow: hidden;
        }
        .app-screen.open { transform: scale(1); opacity: 1; pointer-events: auto; }

        .nav-bar {
            height: 44px; background: linear-gradient(to bottom, #b0bccd 0%, #889bb3 50%, #8195af 51%, #6d84a2 100%);
            border-bottom: 1px solid #2d3642;
            display: flex; align-items: center; justify-content: center;
            color: #fff; font-weight: bold; font-size: 18px;
            text-shadow: 0 -1px 0 rgba(0,0,0,0.5);
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            position: relative; flex-shrink: 0;
        }
        .nav-btn {
            position: absolute; left: 5px; top: 7px;
            height: 30px; padding: 0 10px;
            background: linear-gradient(to bottom, #9fabc2 0%, #6a81a1 100%);
            border: 1px solid #4a6c8e; border-radius: 5px;
            font-size: 12px; display: flex; align-items: center;
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.3);
            cursor: pointer;
        }

        .app-content { flex-grow: 1; overflow-y: auto; position: relative; }

        #app-notes .app-content {
            background: 
                linear-gradient(#fcf6d6 100%, transparent 0),
                repeating-linear-gradient(transparent, transparent 29px, #d6eaf7 29px, #d6eaf7 30px);
            background-color: #fcf6d6;
            padding: 0 20px;
            font-family: "Marker Felt", "Comic Sans MS", cursive;
            line-height: 30px; color: #333; font-size: 18px;
        }
        .paper-title { font-size: 22px; color: #000; margin-top: 10px; border-bottom: 2px solid #e4d5a9; }

        #app-terminal .app-content { background: #000; color: #0f0; padding: 10px; font-family: "Courier New", monospace; font-size: 14px; }
        .cmd { color: #fff; font-weight: bold; }
        .cursor { animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }

        #app-photos .app-content { background: #222; padding: 5px; }
        .photo-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 5px; }
        .photo-thumb {
            aspect-ratio: 1; background: #fff; border: 3px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.5);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; overflow: hidden;
        }
        .photo-thumb img { width: 100%; height: 80%; object-fit: cover; }
        .photo-caption { font-size: 10px; color: #333; height: 20%; display: flex; align-items: center; }

        #photo-modal {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 200; display: none;
            justify-content: center; align-items: center;
        }
        #photo-modal img { max-width: 100%; max-height: 100%; }
        .close-modal { position: absolute; top: 20px; right: 20px; color: #fff; font-size: 30px; cursor: pointer; z-index: 210; }

        #app-game .app-content {
            background: #333; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
        }
        canvas { border: 4px solid #888; border-radius: 4px; background: #aab; box-shadow: inset 0 0 20px rgba(0,0,0,0.2); }
        .game-score { color: #fff; font-family: "Courier New"; font-size: 24px; margin-bottom: 20px; text-shadow: 0 2px 0 #000; }
        
        .game-msg { 
            position: absolute; color: white; background: rgba(0,0,0,0.8); 
            padding: 20px 40px; border-radius: 12px; text-align: center; 
            display: none; cursor: pointer; border: 2px solid #fff;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            z-index: 50;
        }
        .game-msg:active { transform: scale(0.95); background: rgba(0,0,0,0.9); }
        
        .swipe-hint { color: #aaa; margin-top: 10px; font-size: 12px; }

        #app-safari { background: #d8dce0; display: flex; flex-direction: column; }
        .safari-header {
            height: 60px; background: linear-gradient(to bottom, #e6e9ed 0%, #b8c0c8 50%, #a9b4be 51%, #a9b4be 100%);
            border-bottom: 1px solid #555; padding: 8px 10px 5px;
            display: flex; flex-direction: column; gap: 5px;
        }
        .safari-url-box {
            background: #fff; border-radius: 5px; height: 28px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
            display: flex; align-items: center; padding: 0 8px;
            font-size: 13px; color: #333; overflow: hidden; white-space: nowrap;
        }
        .safari-url-box span { color: #888; margin-right: 5px; }
        .safari-content { flex-grow: 1; background: #fff; position: relative; }
        .safari-content iframe { width: 100%; height: 100%; border: none; }
        .safari-footer {
            height: 44px; background: linear-gradient(to bottom, #e6e9ed 0%, #b8c0c8 50%, #a9b4be 51%, #a9b4be 100%);
            border-top: 1px solid #555;
            display: flex; justify-content: space-around; align-items: center;
            font-size: 24px; color: #555;
        }
        .safari-btn { width: 40px; height: 40px; display: flex; justify-content: center; align-items: center; cursor: pointer; }
        .safari-btn:active { opacity: 0.5; }

    </style>
</head>
<body>

<div id="ios-container">
    <div id="status-bar">
        <div class="left">Carrier 3G</div>
        <div class="center" id="clock">12:00</div>
        <div class="right">üîã 100%</div>
    </div>

    <div id="home-screen">
        <div class="app-icon-wrapper" onclick="openApp('app-terminal')">
            <div class="app-icon icon-terminal">>_</div>
            <div class="app-name">Terminal</div>
        </div>
        
        <div class="app-icon-wrapper" onclick="openApp('app-notes')">
            <div class="app-icon icon-notes"></div>
            <div class="app-name">Notes</div>
        </div>

        <div class="app-icon-wrapper" onclick="openApp('app-photos')">
            <div class="app-icon icon-photos"></div>
            <div class="app-name">Photos</div>
        </div>

        <div class="app-icon-wrapper" onclick="openApp('app-game')">
            <div class="app-icon icon-game">üêç</div>
            <div class="app-name">Snake</div>
        </div>
        
        <div class="app-icon-wrapper" onclick="openSafari()">
            <div class="app-icon icon-linkedin">in</div>
            <div class="app-name">LinkedIn</div>
        </div>
    </div>

    <div class="dock-wrapper">
        <div class="app-icon-wrapper" onclick="window.location.href='tel:+123456789'">
            <div class="app-icon icon-phone"></div>
            <div class="app-name">Phone</div>
        </div>
        <div class="app-icon-wrapper" onclick="window.location.href='mailto:mrkovalyskiy@gmail.com'">
            <div class="app-icon icon-mail"></div>
            <div class="app-name">Mail</div>
        </div>
        
        <div class="app-icon-wrapper" onclick="openSafari('https://www.google.com')">
            <div class="app-icon icon-safari"></div>
            <div class="app-name">Safari</div>
        </div>
        
        <div class="app-icon-wrapper">
            <div class="app-icon icon-music"></div>
            <div class="app-name">Music</div>
        </div>
    </div>
    <div id="dock-shelf"></div>

    <div class="app-screen" id="app-safari">
        <div class="safari-header">
            <div class="safari-url-box">
                <span>üîí</span> <div id="safari-url-text">linkedin.com/in/vitalii-strashnov</div>
            </div>
        </div>
        <div class="safari-content">
            <iframe id="safari-frame" src="about:blank"></iframe>
        </div>
        <div class="safari-footer">
            <div class="safari-btn" onclick="history.back()">‚óÄ</div>
            <div class="safari-btn" onclick="history.forward()">‚ñ∂</div>
            <div class="safari-btn">‚éã</div>
            <div class="safari-btn">üìñ</div>
            <div class="safari-btn">‚ùê</div>
        </div>
    </div>

    <div class="app-screen" id="app-notes">
        <div class="nav-bar" style="background: linear-gradient(#f8e79d, #d4b04f); color: #5c4615; text-shadow: none; border-bottom: 1px solid #a38a42;">
            <div class="nav-btn" onclick="closeApp()" style="color: #5c4615; border-color: #a38a42; background: rgba(255,255,255,0.3);">Done</div>
            Summary
        </div>
        <div class="app-content">
            <div class="paper-title">Vitalii Strashnov</div>
            <p><strong>Role:</strong> C++ Developer | ARM Reverse Engineer</p>
            <p>Currently studying at Odessa I.I. Mechnikov National University. Experience with Univ. of T√ºbingen & Stanford.</p>
            <p><strong>Focus:</strong> Performance Optimization, Malware Analysis, Cybersecurity.</p>
            <p><strong>Languages:</strong><br>
            - Ukrainian (Native)<br>
            - Russian (Native)<br>
            - English (Professional)<br>
            - German (Limited)</p>
            <br>
            <p style="color: #666; font-size: 14px;">Last edited: Today</p>
        </div>
    </div>

    <div class="app-screen" id="app-terminal">
        <div class="nav-bar" style="background: #333; border-bottom: 1px solid #000;">
            <div class="nav-btn" onclick="closeApp()" style="background: #555; border: 1px solid #222;">Exit</div>
            Terminal (SSH)
        </div>
        <div class="app-content">
            <div><span class="cmd">vitalii@iphone:~ $</span> ./skills.sh</div>
            <div style="color: white; margin-bottom: 10px;">
                [HARD SKILLS]<br>
                * C++ (High Perf)<br>
                * Assembly (x86/ARM)<br>
                * Reverse Engineering<br>
                * Malware Analysis<br>
                * Algorithms
                <br>
                <br>
                <span class="highlight">[LANGUAGES]</span><br>
                * Ukrainian (Native)<br>
                * Russian (Native)<br>
                * English (Full Professional)<br>
                * German (Limited Working)
            </div>            
            <div><span class="cmd">vitalii@iphone:~ $</span> cat education.txt</div>
            <div style="color: white; margin-bottom: 10px;">
                1. Odessa Mechnikov Univ.<br>
                2. Univ. of T√ºbingen (C++)<br>
                3. Stanford (Algorithms)
            </div>
            <div><span class="cmd">vitalii@iphone:~ $</span> <span class="cursor">_</span></div>
        </div>
    </div>

    <div class="app-screen" id="app-photos">
        <div class="nav-bar">
            <div class="nav-btn" onclick="closeApp()">Albums</div>
            Certificates
        </div>
        <div class="app-content">
            <div class="photo-grid">
                <div class="photo-thumb" onclick="viewPhoto('https://s3.amazonaws.com/coursera_assets/meta_images/generated/CERTIFICATE_LANDING_PAGE/CERTIFICATE_LANDING_PAGE~WCVSN8SKOP14/CERTIFICATE_LANDING_PAGE~WCVSN8SKOP14.jpeg')">
                    <img src="https://s3.amazonaws.com/coursera_assets/meta_images/generated/CERTIFICATE_LANDING_PAGE/CERTIFICATE_LANDING_PAGE~WCVSN8SKOP14/CERTIFICATE_LANDING_PAGE~WCVSN8SKOP14.jpeg">
                    <div class="photo-caption">Stanford Algo</div>
                </div>
                <div class="photo-thumb" onclick="viewPhoto('https://s3.amazonaws.com/coursera_assets/meta_images/generated/CERTIFICATE_LANDING_PAGE/CERTIFICATE_LANDING_PAGE~3KNO407J7EO3/CERTIFICATE_LANDING_PAGE~3KNO407J7EO3.jpeg')">
                    <img src="https://s3.amazonaws.com/coursera_assets/meta_images/generated/CERTIFICATE_LANDING_PAGE/CERTIFICATE_LANDING_PAGE~3KNO407J7EO3/CERTIFICATE_LANDING_PAGE~3KNO407J7EO3.jpeg">
                    <div class="photo-caption">Malware Analysis</div>
                </div>
                <div class="photo-thumb" onclick="viewPhoto('https://media.licdn.com/dms/image/v2/D4E2DAQHHHN9HszcBkQ/profile-treasury-image-shrink_1280_1280/profile-treasury-image-shrink_1280_1280/0/1732133498850?e=1764169200&v=beta&t=Nu_nOGI5l65LkjIbzZ_qPOHfCzbAV3axMFyr7U_7N-8')">
                    <img src="https://media.licdn.com/dms/image/v2/D4E2DAQHHHN9HszcBkQ/profile-treasury-image-shrink_1280_1280/profile-treasury-image-shrink_1280_1280/0/1732133498850?e=1764169200&v=beta&t=Nu_nOGI5l65LkjIbzZ_qPOHfCzbAV3axMFyr7U_7N-8">
                    <div class="photo-caption">ICPC 2024</div>
                </div>
                 <div class="photo-thumb" onclick="viewPhoto('https://media.licdn.com/dms/image/v2/D4E2DAQGsuFTU5XdY6A/profile-treasury-image-shrink_1280_1280/profile-treasury-image-shrink_1280_1280/0/1730292636694?e=1764169200&v=beta&t=Yc8W6Jdm21YcGxRkX2BPqqzkwddVlGYLAPQOrjwZ6Ho')">
                    <img src="https://media.licdn.com/dms/image/v2/D4E2DAQGsuFTU5XdY6A/profile-treasury-image-shrink_1280_1280/profile-treasury-image-shrink_1280_1280/0/1730292636694?e=1764169200&v=beta&t=Yc8W6Jdm21YcGxRkX2BPqqzkwddVlGYLAPQOrjwZ6Ho">
                    <div class="photo-caption">C++ T√ºbingen</div>
                </div>
            </div>
        </div>
        <div id="photo-modal" onclick="this.style.display='none'">
            <div class="close-modal">&times;</div>
            <img id="modal-img" src="">
        </div>
    </div>

    <div class="app-screen" id="app-game">
        <div class="nav-bar" style="background: linear-gradient(#333, #111); border-bottom: 1px solid #555;">
            <div class="nav-btn" onclick="closeApp()" style="background: #444; border-color: #666;">Quit</div>
            Snake
        </div>
        <div class="app-content">
            <div class="game-score" id="score">0</div>
            <canvas id="game-canvas"></canvas>
            <div class="swipe-hint">SWIPE TO MOVE</div>
            
            <!-- Modified Click Handlers here -->
            <div id="start-msg" class="game-msg" style="display: block;" onclick="startGameHandler()">
                <h2>SNAKE BYTE</h2>
                <p>Tap to Start</p>
            </div>
            <div id="game-over-msg" class="game-msg" onclick="restartGameHandler()">
                <h2 style="color:#ff5e3a">GAME OVER</h2>
                <p>Tap to Retry</p>
            </div>
        </div>
    </div>

    <div id="home-btn-area">
        <div id="home-btn" onclick="pressHomeButton()">
            <div class="square"></div>
        </div>
    </div>

</div>

<script>
    function updateClock() {
        const now = new Date();
        const h = now.getHours();
        const m = now.getMinutes().toString().padStart(2, '0');
        document.getElementById('clock').innerText = `${h}:${m}`;
    }
    setInterval(updateClock, 1000);
    updateClock();

    let currentApp = null;

    function openApp(appId) {
        const app = document.getElementById(appId);
        const home = document.getElementById('home-screen');
        const dock = document.querySelector('.dock-wrapper');
        
        home.style.transform = 'scale(1.2)';
        home.style.opacity = '0';
        dock.style.transform = 'translateY(100px)';
        
        setTimeout(() => {
            app.classList.add('open');
            currentApp = appId;
            
            if(appId === 'app-game') {
                initGame();
            }
        }, 100);
    }

    function openSafari(url) {
        const targetUrl = 'https://www.linkedin.com/in/vitalii-strashnov';
        
        openApp('app-safari');
        
        const mockHTML = `
            <body style="margin:0; padding:20px; font-family: Helvetica, sans-serif; background:#f3f6f8; color:#333; display:flex; flex-direction:column; align-items:center; text-align:center;">
                <div style="background:white; padding:20px; border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,0.1); max-width:90%; width:300px;">
                    <div style="width:100px; height:100px; background:#ddd; border-radius:50%; margin:0 auto 15px; overflow:hidden;">
                        <img src="https://media.licdn.com/dms/image/v2/D4E03AQF71Xp-tLh8eQ/profile-displayphoto-shrink_200_200/profile-displayphoto-shrink_200_200/0/1706026605907?e=2147483647&v=beta&t=fLgHwG_9l7zL-5f7a_9l7zL-5f7a" style="width:100%; height:100%; object-fit:cover;" onerror="this.style.display='none'">
                        <div style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; background:#0077b5; color:white; font-size:40px;">in</div>
                    </div>
                    <h2 style="margin:0 0 5px;">Vitalii Strashnov</h2>
                    <p style="margin:0 0 15px; color:#666; font-size:14px;">C++ Developer | ARM Reverse Engineer</p>
                    <button onclick="window.open('${targetUrl}', '_blank')" style="background:#0a66c2; color:white; border:none; padding:10px 20px; border-radius:20px; font-weight:bold; cursor:pointer; width:100%;">View Full Profile</button>
                    <div style="margin-top:15px; border-top:1px solid #eee; padding-top:10px; font-size:12px; color:#888;">
                        Odessa I.I. Mechnikov National University<br>University of T√ºbingen
                    </div>
                </div>
                <p style="margin-top:20px; font-size:11px; color:#999;">Note: Real LinkedIn site cannot be embedded in an iframe due to security settings.</p>
            </body>
        `;
        
        const frame = document.getElementById('safari-frame');
        frame.srcdoc = mockHTML;
        document.getElementById('safari-url-text').innerText = "linkedin.com/in/vitalii-strashnov";
    }

    function closeApp() {
        if(!currentApp) return;
        const app = document.getElementById(currentApp);
        const home = document.getElementById('home-screen');
        const dock = document.querySelector('.dock-wrapper');

        app.classList.remove('open');
        
        home.style.transform = 'scale(1)';
        home.style.opacity = '1';
        dock.style.transform = 'translateY(0)';
        
        if(currentApp === 'app-game') {
            stopGame();
        }
        
        currentApp = null;
    }

    function pressHomeButton() {
        if (currentApp) {
            closeApp();
        } else {
            const home = document.getElementById('home-screen');
            home.style.transform = 'scale(0.95)';
            setTimeout(() => home.style.transform = 'scale(1)', 150);
        }
    }

    function viewPhoto(url) {
        document.getElementById('modal-img').src = url;
        document.getElementById('photo-modal').style.display = 'flex';
    }

    const canvas = document.getElementById('game-canvas');
    const ctx = canvas.getContext('2d');
    
    const size = Math.min(window.innerWidth - 40, 320);
    canvas.width = size;
    canvas.height = size;
    
    const grid = 20;
    const cols = Math.floor(size / grid);
    const rows = Math.floor(size / grid);
    
    let snake = [];
    let apple = {};
    let dx = grid;
    let dy = 0;
    let score = 0;
    let gameInterval;
    let isGameRunning = false;

    function initGame() {
        resetGame();
        document.getElementById('start-msg').style.display = 'block';
        document.getElementById('game-over-msg').style.display = 'none';
    }

    function startGameHandler() {
        if(!isGameRunning) {
            document.getElementById('start-msg').style.display = 'none';
            document.getElementById('game-over-msg').style.display = 'none';
            isGameRunning = true;
            gameLoop();
        }
    }
    
    function restartGameHandler() {
        resetGame();
        startGameHandler();
    }

    function stopGame() {
        isGameRunning = false;
        clearTimeout(gameInterval);
    }

    function resetGame() {
        snake = [{x: Math.floor(cols/2)*grid, y: Math.floor(rows/2)*grid}];
        dx = grid;
        dy = 0;
        score = 0;
        document.getElementById('score').innerText = score;
        spawnApple();
    }

    function spawnApple() {
        apple = {
            x: Math.floor(Math.random() * cols) * grid,
            y: Math.floor(Math.random() * rows) * grid
        };
        for(let cell of snake) {
            if(cell.x === apple.x && cell.y === apple.y) spawnApple();
        }
    }

    function gameLoop() {
        if(!isGameRunning) return;

        gameInterval = setTimeout(() => {
            requestAnimationFrame(gameLoop);
        }, 160);

        const head = { x: snake[0].x + dx, y: snake[0].y + dy };

        if(head.x < 0 || head.x >= canvas.width || head.y < 0 || head.y >= canvas.height) {
            gameOver();
            return;
        }
        
        for(let cell of snake) {
            if(cell.x === head.x && cell.y === head.y) {
                gameOver();
                return;
            }
        }

        snake.unshift(head);

        if(head.x === apple.x && head.y === apple.y) {
            score += 10;
            document.getElementById('score').innerText = score;
            spawnApple();
        } else {
            snake.pop();
        }

        draw();
    }

    function draw() {
        ctx.fillStyle = '#aab';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.strokeStyle = 'rgba(0,0,0,0.1)';
        for(let i=0; i<cols; i++) { ctx.beginPath(); ctx.moveTo(i*grid,0); ctx.lineTo(i*grid, canvas.height); ctx.stroke(); }
        for(let i=0; i<rows; i++) { ctx.beginPath(); ctx.moveTo(0,i*grid); ctx.lineTo(canvas.width, i*grid); ctx.stroke(); }

        ctx.fillStyle = '#ff5e3a';
        ctx.fillRect(apple.x+1, apple.y+1, grid-2, grid-2);

        ctx.fillStyle = '#333';
        snake.forEach(cell => {
            ctx.fillRect(cell.x+1, cell.y+1, grid-2, grid-2);
        });
    }

    function gameOver() {
        isGameRunning = false;
        document.getElementById('game-over-msg').style.display = 'block';
    }

    let touchStartX = 0;
    let touchStartY = 0;

    canvas.addEventListener('touchstart', function(e) {
        touchStartX = e.changedTouches[0].screenX;
        touchStartY = e.changedTouches[0].screenY;
    }, {passive: false});

    canvas.addEventListener('touchmove', function(e) {
        e.preventDefault();
    }, {passive: false});

    canvas.addEventListener('touchend', function(e) {
        if(!isGameRunning) return;
        
        let touchEndX = e.changedTouches[0].screenX;
        let touchEndY = e.changedTouches[0].screenY;
        
        handleSwipe(touchStartX, touchStartY, touchEndX, touchEndY);
    }, {passive: false});

    function handleSwipe(sx, sy, ex, ey) {
        let diffX = ex - sx;
        let diffY = ey - sy;
        
        if(Math.abs(diffX) > Math.abs(diffY)) {
            if(Math.abs(diffX) > 30) { 
                if(diffX > 0 && dx === 0) { dx = grid; dy = 0; }
                else if(diffX < 0 && dx === 0) { dx = -grid; dy = 0; }
            }
        } else {
            if(Math.abs(diffY) > 30) {
                if(diffY > 0 && dy === 0) { dy = grid; dx = 0; }
                else if(diffY < 0 && dy === 0) { dy = -grid; dx = 0; }
            }
        }
    }

</script>

</body>
</html>
